<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FrontendRAFT - Basic Example</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2.5em;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 0.9em;
    }
    .status {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-weight: 500;
    }
    .status.loading {
      background: #fff3cd;
      color: #856404;
    }
    .status.ready {
      background: #d4edda;
      color: #155724;
    }
    .section {
      margin: 30px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
    }
    .section h3 {
      color: #333;
      margin-bottom: 15px;
    }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
      transition: all 0.3s;
    }
    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    input {
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      width: 100%;
      margin-bottom: 10px;
    }
    .output {
      background: #2d3748;
      color: #68d391;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .badge {
      display: inline-block;
      background: #667eea;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.8em;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ FrontendRAFT</h1>
    <p class="subtitle">RAFT = Reactive API for Frontend Transformation<br>Based on CSOP</p>
    
    <div id="status" class="status loading">
      ‚è≥ Initializing RAFT...
    </div>

    <div class="section">
      <h3>üì° API Info <span class="badge" id="api-id">Loading...</span></h3>
      <div id="api-info" class="output">Waiting for initialization...</div>
    </div>

    <div class="section">
      <h3>üíæ Storage Test</h3>
      <input type="text" id="storage-input" placeholder="Enter some data...">
      <button onclick="testStorage()">Save to Storage</button>
      <button onclick="getStorage()">Load from Storage</button>
      <div id="storage-output" class="output"></div>
    </div>

    <div class="section">
      <h3>üìä Cache Test</h3>
      <button onclick="testCache()">Set Cache (5s TTL)</button>
      <button onclick="getCache()">Get Cache</button>
      <button onclick="clearCache()">Clear Cache</button>
      <div id="cache-output" class="output"></div>
    </div>

    <div class="section">
      <h3>üîÑ Stream Test</h3>
      <button onclick="startStream()">Start Streaming</button>
      <button onclick="broadcastMessage()">Broadcast Message</button>
      <button onclick="stopStream()">Stop Streaming</button>
      <div id="stream-output" class="output"></div>
    </div>

    <div class="section">
      <h3>üîç Query Test</h3>
      <button onclick="testQuery()">Query Data</button>
      <div id="query-output" class="output"></div>
    </div>
  </div>

  <script type="module">
    import { FrontendRAFT } from 'https://cdn.jsdelivr.net/gh/Nexus-Studio-CEO/FrontendRAFT@v0.1.0/dist/index.mjs';

    let raft;
    let streamSub;

    async function init() {
      try {
        raft = new FrontendRAFT({
          name: "Basic Example API",
          autoRegister: true
        });

        await raft.init();

        // Update status
        document.getElementById('status').className = 'status ready';
        document.getElementById('status').textContent = '‚úÖ RAFT Ready!';

        // Show API info
        const metadata = raft.getMetadata();
        document.getElementById('api-id').textContent = metadata.apiId || 'Local';
        document.getElementById('api-info').textContent = JSON.stringify(metadata, null, 2);

        // Define some routes
        raft.get('/hello', async (req) => {
          return { message: 'Hello from FrontendRAFT!' };
        });

        window.raft = raft; // Make available globally
      } catch (error) {
        document.getElementById('status').textContent = '‚ùå Error: ' + error.message;
      }
    }

    window.testStorage = async function() {
      const input = document.getElementById('storage-input').value;
      if (!input) return alert('Enter some data first!');
      
      await raft.storage.save('test-data', { value: input, timestamp: Date.now() });
      document.getElementById('storage-output').textContent = '‚úÖ Saved: ' + input;
    };

    window.getStorage = async function() {
      try {
        const data = await raft.storage.get('test-data');
        document.getElementById('storage-output').textContent = 'üì¶ Loaded: ' + JSON.stringify(data, null, 2);
      } catch (error) {
        document.getElementById('storage-output').textContent = '‚ùå No data found';
      }
    };

    window.testCache = async function() {
      const data = { cached: true, time: new Date().toISOString() };
      await raft.cache.set('test-cache', data, { ttl: 5000 });
      document.getElementById('cache-output').textContent = '‚úÖ Cached for 5 seconds:\n' + JSON.stringify(data, null, 2);
    };

    window.getCache = async function() {
      const data = await raft.cache.get('test-cache');
      if (data) {
        document.getElementById('cache-output').textContent = '‚úÖ Cache hit:\n' + JSON.stringify(data, null, 2);
      } else {
        document.getElementById('cache-output').textContent = '‚ùå Cache miss (expired or empty)';
      }
    };

    window.clearCache = async function() {
      await raft.cache.delete('test-cache');
      document.getElementById('cache-output').textContent = 'üóëÔ∏è Cache cleared';
    };

    window.startStream = async function() {
      if (streamSub) return alert('Already streaming!');
      
      document.getElementById('stream-output').textContent = 'üì° Listening for messages...\n';
      
      streamSub = await raft.stream.subscribe('demo', (data) => {
        const output = document.getElementById('stream-output');
        output.textContent += `üì® ${new Date().toLocaleTimeString()}: ${JSON.stringify(data)}\n`;
        output.scrollTop = output.scrollHeight;
      });
    };

    window.broadcastMessage = async function() {
      if (!streamSub) return alert('Start streaming first!');
      
      await raft.stream.broadcast('demo', {
        message: 'Hello from browser!',
        timestamp: Date.now()
      });
    };

    window.stopStream = async function() {
      if (!streamSub) return;
      await streamSub.unsubscribe();
      streamSub = null;
      document.getElementById('stream-output').textContent += '\nüõë Streaming stopped';
    };

    window.testQuery = async function() {
      // Create some test data first
      for (let i = 1; i <= 5; i++) {
        await raft.storage.save(`user:${i}`, {
          id: i,
          name: `User ${i}`,
          age: 20 + i,
          active: i % 2 === 0
        });
      }

      // Query
      const result = await raft.query.query('user', {
        where: { active: true },
        select: ['name', 'age'],
        orderBy: { field: 'age', direction: 'desc' },
        limit: 3
      });

      document.getElementById('query-output').textContent = 
        'üîç Query results:\n' + JSON.stringify(result, null, 2);
    };

    // Initialize on load
    init();
  </script>
</body>
</html>