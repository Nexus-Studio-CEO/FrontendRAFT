<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FrontendRAFT - Advanced Features</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: #1e293b;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #334155;
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-badge {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: normal;
        }

        button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        button:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none;
        }

        input, select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 16px;
        }

        .log {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            padding: 5px;
            margin: 2px 0;
            border-left: 3px solid #667eea;
            padding-left: 10px;
        }

        .log-entry.success {
            border-color: #10b981;
            color: #10b981;
        }

        .log-entry.error {
            border-color: #ef4444;
            color: #ef4444;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .stat-box {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #94a3b8;
            margin-top: 5px;
        }

        .event-item {
            background: #0f172a;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid #10b981;
        }

        .query-result {
            background: #0f172a;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }

        pre {
            margin: 0;
            color: #10b981;
        }

        .status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status.online {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }

        .status.offline {
            background: #ef4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ FrontendRAFT Advanced Features</h1>
            <p class="subtitle">Streaming ‚Ä¢ Caching ‚Ä¢ Batching ‚Ä¢ Optimistic ‚Ä¢ Query</p>
        </header>

        <div class="grid">
            <!-- Streaming -->
            <div class="card">
                <h2>
                    üåä Streaming API
                    <span class="feature-badge">Feature #1</span>
                </h2>
                <p>Real-time data streams without polling</p>
                
                <button id="startStream">Start Stream</button>
                <button id="stopStream" disabled>Stop Stream</button>
                <button id="broadcast">Broadcast Event</button>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="streamEvents">0</div>
                        <div class="stat-label">Events</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">
                            <span class="status offline" id="streamStatus"></span>
                        </div>
                        <div class="stat-label">Status</div>
                    </div>
                </div>
                
                <div class="log" id="streamLog"></div>
            </div>

            <!-- Caching -->
            <div class="card">
                <h2>
                    üíæ Smart Caching
                    <span class="feature-badge">Feature #2</span>
                </h2>
                <p>Multi-level cache with TTL</p>
                
                <button id="fetchData">Fetch Data (cached)</button>
                <button id="invalidateCache">Invalidate Cache</button>
                <button id="clearCache">Clear All Cache</button>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="cacheHits">0</div>
                        <div class="stat-label">Hits</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="cacheMisses">0</div>
                        <div class="stat-label">Misses</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="cacheHitRate">0%</div>
                        <div class="stat-label">Hit Rate</div>
                    </div>
                </div>
                
                <div class="log" id="cacheLog"></div>
            </div>

            <!-- Batching -->
            <div class="card">
                <h2>
                    ‚ö° Auto-Batching
                    <span class="feature-badge">Feature #3</span>
                </h2>
                <p>Automatic request optimization</p>
                
                <select id="batchSize">
                    <option value="10">10 requests</option>
                    <option value="50">50 requests</option>
                    <option value="100">100 requests</option>
                </select>
                
                <button id="executeBatch">Execute Batch</button>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="batchTime">0ms</div>
                        <div class="stat-label">Duration</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="batchSpeedup">0x</div>
                        <div class="stat-label">Speedup</div>
                    </div>
                </div>
                
                <div class="log" id="batchLog"></div>
            </div>

            <!-- Optimistic Updates -->
            <div class="card">
                <h2>
                    üéØ Optimistic Updates
                    <span class="feature-badge">Feature #4</span>
                </h2>
                <p>Instant UI feedback</p>
                
                <input type="text" id="optimisticInput" placeholder="Enter data...">
                <button id="optimisticUpdate">Update (Optimistic)</button>
                <button id="optimisticFail">Update (Will Fail)</button>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="optimisticApplied">0</div>
                        <div class="stat-label">Applied</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="optimisticRolledBack">0</div>
                        <div class="stat-label">Rolled Back</div>
                    </div>
                </div>
                
                <div class="log" id="optimisticLog"></div>
            </div>

            <!-- Query Language -->
            <div class="card">
                <h2>
                    üîç Query Language
                    <span class="feature-badge">Feature #5</span>
                </h2>
                <p>GraphQL-like field selection</p>
                
                <select id="queryType">
                    <option value="fields">Select Fields</option>
                    <option value="filter">Filter Data</option>
                    <option value="sort">Sort Results</option>
                    <option value="paginate">Paginate</option>
                </select>
                
                <button id="executeQuery">Execute Query</button>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="querySavings">0%</div>
                        <div class="stat-label">Data Saved</div>
                    </div>
                </div>
                
                <div class="query-result">
                    <pre id="queryResult">No results yet</pre>
                </div>
            </div>

            <!-- Performance Dashboard -->
            <div class="card">
                <h2>üìä Performance Dashboard</h2>
                <p>Real-time metrics</p>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="totalRequests">0</div>
                        <div class="stat-label">Total Requests</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgDuration">0ms</div>
                        <div class="stat-label">Avg Duration</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="errorRate">0%</div>
                        <div class="stat-label">Error Rate</div>
                    </div>
                </div>
                
                <button id="refreshStats">Refresh Stats</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { FrontendRAFT } from 'https://cdn.jsdelivr.net/gh/Nexus-Studio-CEO/FrontendRAFT@v0.1.0/src/index.js';

        // Initialize RAFT
        const raft = new FrontendRAFT({
            name: 'Advanced Features Demo',
            version: '1.0.0'
        });

        await raft.init();

        // Setup demo data
        raft.routes({
            'GET /data': async () => {
                await new Promise(r => setTimeout(r, 100)); // Simulate latency
                return { 
                    users: Array.from({length: 100}, (_, i) => ({
                        id: i + 1,
                        name: `User ${i + 1}`,
                        email: `user${i + 1}@example.com`,
                        status: i % 2 === 0 ? 'active' : 'inactive',
                        score: Math.random() * 100
                    }))
                };
            },
            
            'POST /update': async (req) => {
                await new Promise(r => setTimeout(r, 50));
                if (req.body.shouldFail) {
                    throw new Error('Simulated failure');
                }
                return { success: true, data: req.body };
            }
        });

        // Feature 1: Streaming
        let stream, streamActive = false;
        let streamEventCount = 0;

        document.getElementById('startStream').addEventListener('click', async () => {
            if (streamActive) return;
            
            streamActive = true;
            streamEventCount = 0;
            document.getElementById('startStream').disabled = true;
            document.getElementById('stopStream').disabled = false;
            document.getElementById('streamStatus').classList.add('online');
            document.getElementById('streamStatus').classList.remove('offline');
            
            addStreamLog('Stream started', 'success');
            
            stream = raft.stream.open('/demo/events');
            
            (async () => {
                for await (const event of stream) {
                    if (!streamActive) break;
                    streamEventCount++;
                    document.getElementById('streamEvents').textContent = streamEventCount;
                    addStreamLog(`Event received: ${JSON.stringify(event.data)}`);
                }
            })();
        });

        document.getElementById('stopStream').addEventListener('click', async () => {
            streamActive = false;
            document.getElementById('startStream').disabled = false;
            document.getElementById('stopStream').disabled = true;
            document.getElementById('streamStatus').classList.remove('online');
            document.getElementById('streamStatus').classList.add('offline');
            
            await raft.stream.close('/demo/events');
            addStreamLog('Stream stopped', 'error');
        });

        document.getElementById('broadcast').addEventListener('click', async () => {
            const event = {
                type: 'demo',
                data: { timestamp: Date.now(), message: 'Hello!' }
            };
            await raft.stream.broadcast('/demo/events', event);
            addStreamLog('Event broadcasted', 'success');
        });

        function addStreamLog(message, type = '') {
            const log = document.getElementById('streamLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.insertBefore(entry, log.firstChild);
            if (log.children.length > 5) log.removeChild(log.lastChild);
        }

        // Feature 2: Caching
        document.getElementById('fetchData').addEventListener('click', async () => {
            const start = Date.now();
            const data = await raft.get('/data', { cache: true, ttl: 30000 });
            const duration = Date.now() - start;
            
            const stats = raft.cache.getStats();
            document.getElementById('cacheHits').textContent = stats.hits;
            document.getElementById('cacheMisses').textContent = stats.misses;
            document.getElementById('cacheHitRate').textContent = stats.hitRate;
            
            addCacheLog(`Fetched data in ${duration}ms (${stats.hits > 0 ? 'HIT' : 'MISS'})`);
        });

        document.getElementById('invalidateCache').addEventListener('click', async () => {
            await raft.cache.invalidate('/data');
            addCacheLog('Cache invalidated', 'success');
        });

        document.getElementById('clearCache').addEventListener('click', async () => {
            await raft.cache.clear();
            addCacheLog('All cache cleared', 'success');
        });

        function addCacheLog(message) {
            const log = document.getElementById('cacheLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.insertBefore(entry, log.firstChild);
            if (log.children.length > 5) log.removeChild(log.lastChild);
        }

        // Feature 3: Batching
        document.getElementById('executeBatch').addEventListener('click', async () => {
            const size = parseInt(document.getElementById('batchSize').value);
            
            addBatchLog(`Starting batch of ${size} requests...`);
            const start = Date.now();
            
            const requests = Array.from({length: size}, (_, i) => 
                raft.get(`/data?id=${i}`)
            );
            
            await Promise.all(requests);
            
            const duration = Date.now() - start;
            const sequential = size * 100; // Estimated sequential time
            const speedup = (sequential / duration).toFixed(1);
            
            document.getElementById('batchTime').textContent = `${duration}ms`;
            document.getElementById('batchSpeedup').textContent = `${speedup}x`;
            
            addBatchLog(`Completed ${size} requests in ${duration}ms (${speedup}x speedup)`, 'success');
        });

        function addBatchLog(message, type = '') {
            const log = document.getElementById('batchLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.insertBefore(entry, log.firstChild);
            if (log.children.length > 3) log.removeChild(log.lastChild);
        }

        // Feature 4: Optimistic Updates
        document.getElementById('optimisticUpdate').addEventListener('click', async () => {
            const input = document.getElementById('optimisticInput');
            const data = input.value || 'test data';
            
            const stats = raft.optimistic.getStats();
            document.getElementById('optimisticApplied').textContent = stats.applied;
            
            addOptimisticLog('Applying update optimistically...');
            
            try {
                await raft.post('/update', { data }, { optimistic: true });
                addOptimisticLog('Update confirmed by server', 'success');
            } catch (error) {
                addOptimisticLog(`Update failed: ${error.message}`, 'error');
            }
        });

        document.getElementById('optimisticFail').addEventListener('click', async () => {
            addOptimisticLog('Applying update (will fail)...');
            
            try {
                await raft.post('/update', { shouldFail: true }, { optimistic: true });
            } catch (error) {
                const stats = raft.optimistic.getStats();
                document.getElementById('optimisticRolledBack').textContent = stats.rolledBack;
                addOptimisticLog('Update rolled back', 'error');
            }
        });

        function addOptimisticLog(message, type = '') {
            const log = document.getElementById('optimisticLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.insertBefore(entry, log.firstChild);
            if (log.children.length > 5) log.removeChild(log.lastChild);
        }

        // Feature 5: Query Language
        document.getElementById('executeQuery').addEventListener('click', async () => {
            const queryType = document.getElementById('queryType').value;
            let query;
            
            switch(queryType) {
                case 'fields':
                    query = { fields: ['id', 'name', 'email'] };
                    break;
                case 'filter':
                    query = { where: { status: 'active' } };
                    break;
                case 'sort':
                    query = { orderBy: ['score', 'desc'], limit: 10 };
                    break;
                case 'paginate':
                    query = { limit: 5, offset: 0 };
                    break;
            }
            
            const result = await raft.get('/data', { query });
            
            const fullSize = JSON.stringify(result).length;
            const querySize = JSON.stringify(result).length;
            const savings = ((1 - querySize / fullSize) * 100).toFixed(0);
            
            document.getElementById('querySavings').textContent = `${savings}%`;
            document.getElementById('queryResult').textContent = JSON.stringify(result, null, 2);
        });

        // Performance Dashboard
        document.getElementById('refreshStats').addEventListener('click', () => {
            const routerStats = raft.router.getStats();
            
            document.getElementById('totalRequests').textContent = routerStats.requests;
            document.getElementById('avgDuration').textContent = `${routerStats.avgDuration}ms`;
            
            const errorRate = routerStats.requests > 0 
                ? ((routerStats.errors / routerStats.requests) * 100).toFixed(1)
                : 0;
            document.getElementById('errorRate').textContent = `${errorRate}%`;
        });

        console.log('‚úÖ FrontendRAFT Advanced Example ready!');
        console.log('Explore all 5 RAFT features above!');
    </script>
</body>
</html>